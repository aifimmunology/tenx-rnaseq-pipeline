# tenx-rnaseq-pipeline

Scripts for processing files through a non-hashed 10x Genomics scRNA-seq analysis pipeline

## Dependencies

This repository requires that `pandoc` and `libhdf5-devel` libraries are installed:
```
sudo apt-get install pandoc libhdf5-devel
```

It also depends on the `H5weaver` `rmarkdown`, and `optparse` libraries.

`rmarkdown` and `optparse` are available from CRAN, and can be installed in R using:
```
install.packages("rmarkdown")
install.packages("optparse")
```

`H5weaver` is found in the aifimmunology Github repositories. Install with:
```
Sys.setenv(GITHUB_PAT = "[your_PAT_here]")
devtools::install_github("aifimmunology/H5weaver")
```

## Metadata annotation for cellranger results

This repository can add important QC characteristics and cell metadata for non-hashed datasets. It requires the `filtered_feature_bc_matrix.h5` and `molecule_info.h5` files generated by cellranger count as inputs, and generates a decorated output .h5 file based on these parameters and a Well ID.
`run_hto_processing.R` requires a **Sample Sheet**, provided as the -k parameter, which has 4 comma-separated columns: SampleID, BatchID, HashTag, and PoolID.  

There are 5 parameters for this script:  
* `-i or --in_h5`: The path to the filtered_feature_bc_matrix.h5 file  
* `-l or --in_mol`: The path to the molecule_info.h5 file  
* `-w or --in_well`: A well name to use for metadata in the format \[XB][0-9]{3}-P[0-9]C[0-9]W[0-9]
* `-u or --out_cat`: A filename to use to output the modified .h5
* `-o or --out_html`: A filename to use to output the HTML summary report file

An example run for a cellranger count result is:
```
Rscript --vanilla \
  tenx-rnaseq-pipeline/run_add_nonhashed_metadata.R \
  -i /shared/lucasg/pipeline_cellhashing_tests/data/pool16/filtered_feature_bc_matrix.h5 \
  -l /shared/lucasg/pipeline_cellhashing_tests/data/pool16/molecule_info.h5 \
  -w X000-P1C1W3 \
  -u /shared/lucasg/pipeline_cellhashing_tests/output/pool16/X000-P1C1W3.h5 \
  -o /shared/lucasg/pipeline_cellhashing_tests/output/pool16/X000-P1C1W3_metadata_report.html
```

### Tests

Test runs can be performed using datasets provided with the `H5weaver` package by excluding parameters other than `-o`.

```
Rscript --vanilla \
  tenx-rnaseq-pipeline/run_add_nonhashed_metadata.R \
  -o test_metadata_report.html
```
